<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è©³ç´°æƒ…å ±å…¥åŠ› - ã¿ã‚“ãªã®ç¨å‹™é¡§å•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Noto Sans JP", sans-serif;
      background: #F0F4F8;
      min-height: 100vh;
      color: #1F2937;
    }

    .container {
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }

    .header {
      background: #fff;
      padding: 24px 20px;
      text-align: center;
      border-bottom: 2px solid #26A69A;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 22px;
      color: #1F2937;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      color: #6B7280;
    }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .section {
      padding: 24px 20px;
      display: none;
    }

    .section.active {
      display: block;
    }

    /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆæ³•äºº/å€‹äººï¼‰ */
    .tab-container {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 2px solid #E5E7EB;
    }

    .tab {
      flex: 1;
      padding: 12px;
      background: #F9FAFB;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      color: #6B7280;
      transition: all 0.3s;
    }

    .tab.active {
      background: #fff;
      color: #26A69A;
      border-bottom-color: #26A69A;
    }

    .tab:hover:not(.active) {
      background: #F3F4F6;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ— */
    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .form-group label .required {
      color: #EF4444;
      margin-left: 4px;
    }

    .form-group label .optional {
      color: #9CA3AF;
      font-weight: 400;
      margin-left: 4px;
      font-size: 12px;
    }

    .form-group .info-icon {
      display: inline-block;
      margin-left: 4px;
      color: #26A69A;
      cursor: help;
      font-weight: bold;
    }

    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="number"],
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #D1D5DB;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #26A69A;
      box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.1);
    }

    .form-group input:disabled {
      background: #F3F4F6;
      cursor: not-allowed;
    }

    .form-group .help-text {
      font-size: 12px;
      color: #6B7280;
      margin-top: 4px;
    }

    /* é›»è©±ç•ªå·ãƒ»éƒµä¾¿ç•ªå·ï¼ˆ3åˆ†å‰²ï¼‰ */
    .split-input {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .split-input input {
      flex: 1;
    }

    .split-input span {
      color: #9CA3AF;
      font-weight: bold;
    }

    .split-input .search-btn {
      padding: 12px 20px;
      background: #26A69A;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      transition: background 0.3s;
    }

    .split-input .search-btn:hover {
      background: #00897B;
    }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #26A69A;
      margin-bottom: 20px;
      padding-bottom: 8px;
      border-bottom: 2px solid #26A69A;
    }

    /* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
    .radio-group {
      display: flex;
      gap: 16px;
      margin-top: 8px;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      font-weight: 400 !important;
      margin-bottom: 0 !important;
      cursor: pointer;
    }

    .radio-group input[type="radio"] {
      margin-right: 6px;
      cursor: pointer;
    }

    /* ãƒœã‚¿ãƒ³ */
    .button {
      width: 100%;
      padding: 16px;
      background: #26A69A;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 32px;
    }

    .button:hover:not(:disabled) {
      background: #00897B;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(38, 166, 154, 0.3);
    }

    .button:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
      transform: none;
    }

    /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .error-message {
      display: none;
      background: #FEE2E2;
      border: 1px solid #FCA5A5;
      color: #DC2626;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .error-message.show {
      display: block;
    }

    /* æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .success-message {
      text-align: center;
      padding: 48px 20px;
    }

    .success-message h2 {
      font-size: 24px;
      color: #065F46;
      margin-bottom: 16px;
    }

    .success-message p {
      font-size: 16px;
      color: #6B7280;
      line-height: 1.6;
    }

    /* ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹ */
    .info-box {
      background: #F0FDF9;
      border: 1px solid #A7F3D0;
      border-radius: 6px;
      padding: 12px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #065F46;
    }

    .info-box a {
      color: #26A69A;
      text-decoration: underline;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading {
      text-align: center;
      padding: 48px 20px;
    }

    .spinner {
      border: 3px solid #E5E7EB;
      border-top: 3px solid #26A69A;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* éè¡¨ç¤º */
    .hidden {
      display: none !important;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
      .container {
        box-shadow: none;
      }

      .header h1 {
        font-size: 18px;
      }

      .section {
        padding: 20px 16px;
      }

      .tab {
        font-size: 14px;
        padding: 10px;
      }

      .split-input {
        flex-wrap: wrap;
      }

      .split-input .search-btn {
        width: 100%;
        margin-top: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1>ğŸ“‹ è©³ç´°æƒ…å ±å…¥åŠ›</h1>
      <p>ãŠç”³ã—è¾¼ã¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚è¿½åŠ æƒ…å ±ã®ã”å…¥åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>
    </div>

    <!-- èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="auth-section" class="section active">
      <div class="section-title">ç°¡æ˜“èªè¨¼</div>
      <div class="info-box">
        æ±ºæ¸ˆæ™‚ã«ã”ä½¿ç”¨ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®<strong>æœ€åˆã®3æ–‡å­—</strong>ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      </div>
      <div class="error-message" id="auth-error"></div>
      <div class="form-group">
        <label for="email-prefix">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ€åˆã®3æ–‡å­— <span class="required">*</span></label>
        <input type="text" id="email-prefix" maxlength="3" placeholder="ä¾‹: tes" autocomplete="off">
      </div>
      <button class="button" onclick="authenticate()">èªè¨¼ã™ã‚‹</button>
    </section>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="loading-section" class="section">
      <div class="loading">
        <div class="spinner"></div>
        <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
      </div>
    </section>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="form-section" class="section">
      <div class="error-message" id="form-error"></div>

      <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
      <div class="tab-container">
        <button class="tab active" id="tab-corporate" onclick="switchTab('corporate')">æ³•äºº</button>
        <button class="tab" id="tab-individual" onclick="switchTab('individual')">å€‹äºº</button>
      </div>

      <form id="lp2-form">
        <!-- æ³•äººæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ³•äººã®ã¿ï¼‰ -->
        <div id="corporate-section" class="hidden">
          <div class="section-title">æ³•äººæƒ…å ±</div>
          
          <div class="form-group">
            <label for="corp-name">æ³•äººå <span class="required">*</span></label>
            <input type="text" id="corp-name" data-field="corpName">
          </div>

          <div class="form-group">
            <label for="corp-name-kana">æ³•äººåãƒ•ãƒªã‚¬ãƒŠ <span class="required">*</span></label>
            <input type="text" id="corp-name-kana" data-field="corpNameKana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
          </div>

          <div class="form-group">
            <label for="corp-number">æ³•äººç•ªå· <span class="optional">(ä»»æ„)</span></label>
            <input type="text" id="corp-number" data-field="corpNumber" maxlength="13" placeholder="13æ¡ã®æ³•äººç•ªå·">
          </div>

          <div class="form-group">
            <label>æ³•äººé›»è©±ç•ªå· <span class="required">*</span></label>
            <div class="split-input">
              <input type="text" id="corp-tel1" data-field="corpTel1" maxlength="4" placeholder="03">
              <span>-</span>
              <input type="text" id="corp-tel2" data-field="corpTel2" maxlength="4" placeholder="1234">
              <span>-</span>
              <input type="text" id="corp-tel3" data-field="corpTel3" maxlength="4" placeholder="5678">
            </div>
          </div>

          <div class="form-group">
            <label>æ³•äººéƒµä¾¿ç•ªå· <span class="required">*</span></label>
            <div class="split-input">
              <input type="text" id="corp-postal1" data-field="corpPostal1" maxlength="3" placeholder="100">
              <span>-</span>
              <input type="text" id="corp-postal2" data-field="corpPostal2" maxlength="4" placeholder="0001">
              <button type="button" class="search-btn" onclick="searchAddress('corp')">éƒµä¾¿ç•ªå·ã§æ¤œç´¢</button>
            </div>
          </div>

          <div class="form-group">
            <label for="corp-prefecture">éƒ½é“åºœçœŒ <span class="required">*</span></label>
            <select id="corp-prefecture" data-field="corpPrefecture">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>

          <div class="form-group">
            <label for="corp-address1">ä½æ‰€1ï¼ˆå¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ï¼‰ <span class="required">*</span></label>
            <input type="text" id="corp-address1" data-field="corpAddress1" placeholder="ä¾‹: åƒä»£ç”°åŒºåƒä»£ç”°1-1">
          </div>

          <div class="form-group">
            <label for="corp-address1-kana">ä½æ‰€1ãƒ•ãƒªã‚¬ãƒŠï¼ˆå¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ï¼‰ <span class="optional">(ä»»æ„)</span></label>
            <input type="text" id="corp-address1-kana" data-field="corpAddress1Kana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
          </div>

          <div class="form-group">
            <label for="corp-address2">ä½æ‰€2ï¼ˆå»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·ãªã©ï¼‰ <span class="optional">(ä»»æ„)</span></label>
            <input type="text" id="corp-address2" data-field="corpAddress2" placeholder="ä¾‹: â—‹â—‹ãƒ“ãƒ«3F">
          </div>

          <div class="form-group">
            <label for="corp-address2-kana">ä½æ‰€2ãƒ•ãƒªã‚¬ãƒŠï¼ˆå»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·ãªã©ï¼‰ <span class="optional">(ä»»æ„)</span></label>
            <input type="text" id="corp-address2-kana" data-field="corpAddress2Kana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
          </div>
        </div>

        <!-- å…±é€šæƒ…å ±ï¼šæ‰€è½„ã®ç¨å‹™ç½² -->
        <div class="section-title">æ‰€è½„ã®ç¨å‹™ç½²</div>
        <div class="info-box">
          å¿…ãšã”ç¢ºèªã‚’ãŠé¡˜ã„è‡´ã—ã¾ã™ã€‚<a href="https://www.nta.go.jp/about/organization/access/map.htm" target="_blank">ã“ã¡ã‚‰</a>ã‹ã‚‰æ¤œç´¢ãŒå¯èƒ½ã§ã™ã€‚
        </div>
        <div class="form-group">
          <label for="tax-office">æ‰€è½„ã®ç¨å‹™ç½² <span class="required">*</span></label>
          <input type="text" id="tax-office" data-field="taxOffice" placeholder="ä¾‹: éº¹ç”ºç¨å‹™ç½²">
        </div>

        <!-- ä»£è¡¨è€…æƒ…å ±/å€‹äººæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section-title" id="rep-section-title">ä»£è¡¨è€…æƒ…å ±</div>

        <div class="form-group">
          <label for="rep-name"><span id="rep-name-label">ä»£è¡¨è€…å</span> <span class="required">*</span></label>
          <input type="text" id="rep-name" data-field="repName">
        </div>

        <div class="form-group">
          <label for="rep-name-kana"><span id="rep-name-kana-label">ä»£è¡¨è€…ãƒ•ãƒªã‚¬ãƒŠ</span> <span class="required">*</span></label>
          <input type="text" id="rep-name-kana" data-field="repNameKana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
        </div>

        <div class="form-group">
          <label><span id="rep-tel-label">ä»£è¡¨è€…é›»è©±ç•ªå·</span> <span class="required">*</span></label>
          <div class="split-input">
            <input type="text" id="rep-tel1" data-field="repTel1" maxlength="4" placeholder="090">
            <span>-</span>
            <input type="text" id="rep-tel2" data-field="repTel2" maxlength="4" placeholder="1234">
            <span>-</span>
            <input type="text" id="rep-tel3" data-field="repTel3" maxlength="4" placeholder="5678">
          </div>
        </div>

        <div class="form-group">
          <label><span id="rep-postal-label">ä»£è¡¨è€…éƒµä¾¿ç•ªå·</span> <span class="required">*</span></label>
          <div class="split-input">
            <input type="text" id="rep-postal1" data-field="repPostal1" maxlength="3" placeholder="100">
            <span>-</span>
            <input type="text" id="rep-postal2" data-field="repPostal2" maxlength="4" placeholder="0001">
            <button type="button" class="search-btn" onclick="searchAddress('rep')">éƒµä¾¿ç•ªå·ã§æ¤œç´¢</button>
          </div>
        </div>

        <div class="form-group">
          <label for="rep-prefecture"><span id="rep-prefecture-label">ä»£è¡¨è€…éƒ½é“åºœçœŒ</span> <span class="required">*</span></label>
          <select id="rep-prefecture" data-field="repPrefecture">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          </select>
        </div>

        <div class="form-group">
          <label for="rep-address1"><span id="rep-address1-label">ä»£è¡¨è€…ä½æ‰€1</span>ï¼ˆå¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ï¼‰ <span class="required">*</span></label>
          <input type="text" id="rep-address1" data-field="repAddress1" placeholder="ä¾‹: åƒä»£ç”°åŒºåƒä»£ç”°1-1">
        </div>

        <div class="form-group">
          <label for="rep-address1-kana"><span id="rep-address1-kana-label">ä»£è¡¨è€…ä½æ‰€1ãƒ•ãƒªã‚¬ãƒŠ</span>ï¼ˆå¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ï¼‰ <span class="optional">(ä»»æ„)</span></label>
          <input type="text" id="rep-address1-kana" data-field="repAddress1Kana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
        </div>

        <div class="form-group">
          <label for="rep-address2"><span id="rep-address2-label">ä»£è¡¨è€…ä½æ‰€2</span>ï¼ˆå»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·ãªã©ï¼‰ <span class="optional">(ä»»æ„)</span></label>
          <input type="text" id="rep-address2" data-field="repAddress2" placeholder="ä¾‹: â—‹â—‹ãƒãƒ³ã‚·ãƒ§ãƒ³101">
        </div>

        <div class="form-group">
          <label for="rep-address2-kana"><span id="rep-address2-kana-label">ä»£è¡¨è€…ä½æ‰€2ãƒ•ãƒªã‚¬ãƒŠ</span>ï¼ˆå»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·ãªã©ï¼‰ <span class="optional">(ä»»æ„)</span></label>
          <input type="text" id="rep-address2-kana" data-field="repAddress2Kana" placeholder="ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›">
        </div>

        <!-- e-Tax/e-Ltaxæƒ…å ± -->
        <div class="section-title">e-Tax / e-Ltaxæƒ…å ±</div>

        <div class="form-group">
          <label for="etax-id">e-taxåˆ©ç”¨è€…è­˜åˆ¥ç•ªå· <span class="required">*</span></label>
          <input type="text" id="etax-id" data-field="etaxId" maxlength="16" placeholder="16æ¡ã®ç•ªå·">
        </div>

        <div class="form-group">
          <label for="etax-password">e-taxæš—è¨¼ç•ªå· <span class="required">*</span></label>
          <input type="text" id="etax-password" data-field="etaxPassword" placeholder="æš—è¨¼ç•ªå·">
        </div>

        <!-- e-Ltaxï¼ˆæ³•äººã®ã¿ï¼‰ -->
        <div id="eltax-section" class="hidden">
          <div class="form-group">
            <label for="eltax-id">e-Ltaxåˆ©ç”¨è€…ID <span class="required">*</span></label>
            <input type="text" id="eltax-id" data-field="eltaxId">
          </div>

          <div class="form-group">
            <label for="eltax-password">e-Ltaxæš—è¨¼ç•ªå· <span class="required">*</span></label>
            <input type="text" id="eltax-password" data-field="eltaxPassword">
          </div>
        </div>

        <!-- æ³•äººè¿½åŠ æƒ…å ±ï¼ˆæ³•äººã®ã¿ï¼‰ -->
        <div id="corporate-extra-section" class="hidden">
          <div class="section-title">æ³•äººè¿½åŠ æƒ…å ±</div>

          <div class="form-group">
            <label for="capital">è³‡æœ¬é‡‘ã®é¡ã‚’ã”æ•™ç¤ºãã ã•ã„ã€‚ <span class="required">*</span></label>
            <input type="number" id="capital" data-field="capital" placeholder="ä¾‹: 1000000">
            <div class="help-text">å˜ä½ï¼šå††</div>
          </div>

          <div class="form-group">
            <label for="fiscal-month">æ±ºç®—æœˆ <span class="required">*</span></label>
            <select id="fiscal-month" data-field="fiscalMonth">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="1">1æœˆ</option>
              <option value="2">2æœˆ</option>
              <option value="3">3æœˆ</option>
              <option value="4">4æœˆ</option>
              <option value="5">5æœˆ</option>
              <option value="6">6æœˆ</option>
              <option value="7">7æœˆ</option>
              <option value="8">8æœˆ</option>
              <option value="9">9æœˆ</option>
              <option value="10">10æœˆ</option>
              <option value="11">11æœˆ</option>
              <option value="12">12æœˆ</option>
            </select>
          </div>

          <div class="form-group">
            <label for="officer-count">å½¹å“¡äººæ•° <span class="required">*</span></label>
            <input type="number" id="officer-count" data-field="officerCount" placeholder="ä¾‹: 2" min="0">
            <div class="help-text">ä¾‹ï¼šå½¹å“¡ã€éå¸¸å‹¤å½¹å“¡ï¼‘åãšã¤ã®å ´åˆã€äººæ•°ã¯ï¼’ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>
          </div>

          <div class="form-group">
            <label for="employee-count-corp">å¾“æ¥­å“¡æ•°ï¼ˆå½¹å“¡ä»¥å¤–ã®äººæ•°ï¼‰ <span class="required">*</span></label>
            <input type="number" id="employee-count-corp" data-field="employeeCount" placeholder="ä¾‹: 5" min="0" value="0">
            <div class="help-text"><strong>å¾“æ¥­å“¡ãŒã„ãªã„å ´åˆã¯0ã¨è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚</strong></div>
          </div>
        </div>

        <!-- å€‹äººï¼šå¾“æ¥­å“¡æ•° -->
        <div id="individual-employee-section" class="hidden">
          <div class="section-title">å¾“æ¥­å“¡æƒ…å ±</div>
          <div class="form-group">
            <label for="employee-count-ind">å¾“æ¥­å“¡æ•°ï¼ˆå°‚å¾“è€…çµ¦ä¸ã€ã¾ãŸã¯å¾“æ¥­å“¡ã‚’é›‡ç”¨ã—ã¦ã„ã‚‹äººæ•°ï¼‰ <span class="required">*</span></label>
            <input type="number" id="employee-count-ind" data-field="employeeCount" placeholder="ä¾‹: 2" min="0" value="0">
            <div class="help-text"><strong>æ”¯æ‰•ã„ãŒãªã„å ´åˆã¯0ã¨è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚</strong></div>
          </div>
        </div>

        <!-- ä¼šè¨ˆã‚½ãƒ•ãƒˆæƒ…å ± -->
        <div class="section-title">ä¼šè¨ˆã‚½ãƒ•ãƒˆæƒ…å ±</div>

        <div class="form-group">
          <label for="accounting-software">ã‚¯ãƒ©ã‚¦ãƒ‰ä¼šè¨ˆã‚½ãƒ•ãƒˆä½¿ç”¨çŠ¶æ³ <span class="required">*</span></label>
          <select id="accounting-software" data-field="accountingSoftware" onchange="toggleAccountingSoftware()">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ä½¿ç”¨ã—ã¦ã„ã‚‹">ä½¿ç”¨ã—ã¦ã„ã‚‹</option>
            <option value="ä½¿ç”¨ã—ã¦ã„ãªã„">ä½¿ç”¨ã—ã¦ã„ãªã„</option>
          </select>
          <div class="help-text">ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«ã¯ç„¡ã„ã‚‚ã®ã¯ãã®ä»–ã«è¨˜è¼‰ã—ã¦ä¸‹ã•ã„ã€‚</div>
        </div>

        <div id="software-detail-section" class="hidden">
          <div class="form-group">
            <label for="software-name">ä½¿ç”¨ä¸­ã®ä¼šè¨ˆã‚½ãƒ•ãƒˆå <span class="required">*</span></label>
            <select id="software-name" data-field="softwareName" onchange="toggleMfBusinessNumber()">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰">ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰</option>
              <option value="freee">freee</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>

          <div id="other-software-section" class="hidden">
            <div class="form-group">
              <label for="other-software-name">ãã®ä»–ä¼šè¨ˆã‚½ãƒ•ãƒˆå <span class="required">*</span></label>
              <input type="text" id="other-software-name" data-field="otherSoftwareName" placeholder="ã‚½ãƒ•ãƒˆåã‚’å…¥åŠ›">
            </div>
          </div>

          <div id="mf-business-number-section" class="hidden">
            <div class="form-group">
              <label for="mf-business-number">ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰äº‹æ¥­è€…ç•ªå· <span class="required">*</span></label>
              <input type="text" id="mf-business-number" data-field="mfBusinessNumber" placeholder="äº‹æ¥­è€…ç•ªå·ã‚’å…¥åŠ›">
            </div>
          </div>

          <div class="form-group">
            <label for="cloud-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="optional">(ä»»æ„)</span></label>
            <input type="email" id="cloud-email" data-field="cloudEmail" placeholder="ã‚¯ãƒ©ã‚¦ãƒ‰ä¼šè¨ˆã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯ã€ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹">
          </div>
        </div>

        <!-- Chatworkæƒ…å ± -->
        <div class="section-title">Chatworkæƒ…å ±</div>

        <div class="form-group">
          <label>chatworkã®ã”åˆ©ç”¨ <span class="required">*</span></label>
          <div class="radio-group">
            <label>
              <input type="radio" name="chatwork-use" value="ã‚ã‚Š" data-field="chatworkUse" onchange="toggleChatworkEmail()"> ã‚ã‚Š
            </label>
            <label>
              <input type="radio" name="chatwork-use" value="ãªã—" data-field="chatworkUse" onchange="toggleChatworkEmail()"> ãªã—
            </label>
          </div>
        </div>

        <div id="chatwork-email-section" class="hidden">
          <div class="form-group">
            <label for="chatwork-email">Chatworkã‚’ã”åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">*</span></label>
            <input type="email" id="chatwork-email" data-field="chatworkEmail" placeholder="Chatworkã«ç™»éŒ²ã—ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
          </div>
        </div>

        <button type="submit" class="button">ä¿å­˜ã™ã‚‹</button>
      </form>
    </section>

    <!-- å®Œäº†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="complete-section" class="section">
      <div class="success-message">
        <h2>âœ… å…¥åŠ›å®Œäº†</h2>
        <p>è©³ç´°æƒ…å ±ã®ã”å…¥åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>
        <p style="margin-top: 16px;">æ‹…å½“è€…ã‚ˆã‚Š3å–¶æ¥­æ—¥ä»¥å†…ã«ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p>
      </div>
    </section>
  </div>

  <script>
    const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwbcjt6pCy-AnRdnA8Vqm4wt7vNVD9lL3hDD2q0H6WTG4CUgC1YzLh28D0aNNRYdRJd/exec'; // v37 (Fåˆ—èª²ç¨å¯¾è±¡è€…)

    let sessionId = '';
    let entityType = 'æ³•äºº'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æ³•äºº
    let formData = {}; // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
    let lp1Data = {}; // LP1ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆå°‚å¾“è€…çµ¦ä¸ã®åˆ¤å®šç”¨ï¼‰

    // éƒ½é“åºœçœŒãƒªã‚¹ãƒˆ
    const prefectures = [
      'åŒ—æµ·é“', 'é’æ£®çœŒ', 'å²©æ‰‹çœŒ', 'å®®åŸçœŒ', 'ç§‹ç”°çœŒ', 'å±±å½¢çœŒ', 'ç¦å³¶çœŒ',
      'èŒ¨åŸçœŒ', 'æ ƒæœ¨çœŒ', 'ç¾¤é¦¬çœŒ', 'åŸ¼ç‰çœŒ', 'åƒè‘‰çœŒ', 'æ±äº¬éƒ½', 'ç¥å¥ˆå·çœŒ',
      'æ–°æ½ŸçœŒ', 'å¯Œå±±çœŒ', 'çŸ³å·çœŒ', 'ç¦äº•çœŒ', 'å±±æ¢¨çœŒ', 'é•·é‡çœŒ',
      'å²é˜œçœŒ', 'é™å²¡çœŒ', 'æ„›çŸ¥çœŒ', 'ä¸‰é‡çœŒ',
      'æ»‹è³€çœŒ', 'äº¬éƒ½åºœ', 'å¤§é˜ªåºœ', 'å…µåº«çœŒ', 'å¥ˆè‰¯çœŒ', 'å’Œæ­Œå±±çœŒ',
      'é³¥å–çœŒ', 'å³¶æ ¹çœŒ', 'å²¡å±±çœŒ', 'åºƒå³¶çœŒ', 'å±±å£çœŒ',
      'å¾³å³¶çœŒ', 'é¦™å·çœŒ', 'æ„›åª›çœŒ', 'é«˜çŸ¥çœŒ',
      'ç¦å²¡çœŒ', 'ä½è³€çœŒ', 'é•·å´çœŒ', 'ç†Šæœ¬çœŒ', 'å¤§åˆ†çœŒ', 'å®®å´çœŒ', 'é¹¿å…å³¶çœŒ', 'æ²–ç¸„çœŒ'
    ];

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
    window.addEventListener('DOMContentLoaded', () => {
      // URLã‹ã‚‰session_idã‚’å–å¾—
      const params = new URLSearchParams(window.location.search);
      sessionId = params.get('session_id');

      if (!sessionId) {
        showError('auth-error', 'ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      console.log('Session ID:', sessionId);

      // éƒ½é“åºœçœŒãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
      initPrefectureSelects();
    });

    // éƒ½é“åºœçœŒãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
    function initPrefectureSelects() {
      const corpPrefecture = document.getElementById('corp-prefecture');
      const repPrefecture = document.getElementById('rep-prefecture');

      prefectures.forEach(pref => {
        const option1 = document.createElement('option');
        option1.value = pref;
        option1.textContent = pref;
        corpPrefecture.appendChild(option1);

        const option2 = document.createElement('option');
        option2.value = pref;
        option2.textContent = pref;
        repPrefecture.appendChild(option2);
      });
    }

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = message;
      errorElement.classList.add('show');
    }

    // ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
    function hideError(elementId) {
      const errorElement = document.getElementById(elementId);
      errorElement.classList.remove('show');
    }

    // èªè¨¼å‡¦ç†
    async function authenticate() {
      const emailPrefix = document.getElementById('email-prefix').value.trim();

      if (!emailPrefix || emailPrefix.length !== 3) {
        showError('auth-error', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ€åˆã®3æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      hideError('auth-error');
      showSection('loading-section');

      console.log('èªè¨¼å‡¦ç†é–‹å§‹');

      try {
        // GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤‰æ›´ï¼ˆCORSã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
        const url = `${GAS_API_URL}?action=authenticateLP2&sessionId=${encodeURIComponent(sessionId)}&emailPrefix=${encodeURIComponent(emailPrefix)}`;
        const response = await fetch(url, {
          method: 'GET'
        });

        const data = await response.json();
        console.log('èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);

        if (data.success) {
          if (data.authenticated) {
            console.log('èªè¨¼æˆåŠŸ - entityType:', data.entityType);
            entityType = data.entityType;
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
            await loadFormData();
          } else {
            showSection('auth-section');
            showError('auth-error', data.message || 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
          }
        } else {
          showSection('auth-section');
          showError('auth-error', data.message || 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
      } catch (error) {
        console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
        showSection('auth-section');
        showError('auth-error', 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function loadFormData() {
      try {
        // GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤‰æ›´ï¼ˆCORSã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
        const url = `${GAS_API_URL}?action=getLP2FormData&sessionId=${encodeURIComponent(sessionId)}`;
        const response = await fetch(url, {
          method: 'GET'
        });

        const data = await response.json();
        console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', data);

        if (data.success) {
          entityType = data.entityType;
          
          if (data.lp2Completed) {
            // å…¥åŠ›æ¸ˆã¿ï¼šãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¦å®Œäº†ç”»é¢ã¸
            showSection('complete-section');
          } else {
            // æœªå…¥åŠ›ï¼šãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
            showSection('form-section');
            // entityTypeã«å¿œã˜ã¦ã‚¿ãƒ–ã¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (entityType === 'å€‹äºº') {
              switchTab('individual');
            } else {
              switchTab('corporate');
            }
          }
        } else {
          showSection('auth-section');
          showError('auth-error', data.message || 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        showSection('auth-section');
        showError('auth-error', 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(type) {
      // ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      saveCurrentFormData();

      // ã‚¿ãƒ–ã®è¦‹ãŸç›®ã‚’åˆ‡ã‚Šæ›¿ãˆ
      document.getElementById('tab-corporate').classList.toggle('active', type === 'corporate');
      document.getElementById('tab-individual').classList.toggle('active', type === 'individual');

      // entityTypeã‚’æ›´æ–°
      const newEntityType = type === 'corporate' ? 'æ³•äºº' : 'å€‹äºº';

      // æ³•äºº/å€‹äººã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
      const isCorporate = type === 'corporate';
      document.getElementById('corporate-section').classList.toggle('hidden', !isCorporate);
      document.getElementById('eltax-section').classList.toggle('hidden', !isCorporate);
      document.getElementById('corporate-extra-section').classList.toggle('hidden', !isCorporate);
      document.getElementById('individual-employee-section').classList.toggle('hidden', isCorporate);

      // ãƒ©ãƒ™ãƒ«ã‚’å¤‰æ›´
      document.getElementById('rep-section-title').textContent = isCorporate ? 'ä»£è¡¨è€…æƒ…å ±' : 'å€‹äººæƒ…å ±';
      document.getElementById('rep-name-label').textContent = isCorporate ? 'ä»£è¡¨è€…å' : 'æ°å';
      document.getElementById('rep-name-kana-label').textContent = isCorporate ? 'ä»£è¡¨è€…ãƒ•ãƒªã‚¬ãƒŠ' : 'ãƒ•ãƒªã‚¬ãƒŠ';
      document.getElementById('rep-tel-label').textContent = isCorporate ? 'ä»£è¡¨è€…é›»è©±ç•ªå·' : 'é›»è©±ç•ªå·';
      document.getElementById('rep-postal-label').textContent = isCorporate ? 'ä»£è¡¨è€…éƒµä¾¿ç•ªå·' : 'éƒµä¾¿ç•ªå·';
      document.getElementById('rep-prefecture-label').textContent = isCorporate ? 'ä»£è¡¨è€…éƒ½é“åºœçœŒ' : 'éƒ½é“åºœçœŒ';
      document.getElementById('rep-address1-label').textContent = isCorporate ? 'ä»£è¡¨è€…ä½æ‰€1' : 'ä½æ‰€1';
      document.getElementById('rep-address1-kana-label').textContent = isCorporate ? 'ä»£è¡¨è€…ä½æ‰€1ãƒ•ãƒªã‚¬ãƒŠ' : 'ä½æ‰€1ãƒ•ãƒªã‚¬ãƒŠ';
      document.getElementById('rep-address2-label').textContent = isCorporate ? 'ä»£è¡¨è€…ä½æ‰€2' : 'ä½æ‰€2';
      document.getElementById('rep-address2-kana-label').textContent = isCorporate ? 'ä»£è¡¨è€…ä½æ‰€2ãƒ•ãƒªã‚¬ãƒŠ' : 'ä½æ‰€2ãƒ•ãƒªã‚¬ãƒŠ';

      // ä¿å­˜ã—ã¦ãŠã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
      restoreFormData();
    }

    // ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
    function saveCurrentFormData() {
      const inputs = document.querySelectorAll('[data-field]');
      inputs.forEach(input => {
        const field = input.dataset.field;
        if (input.type === 'radio') {
          if (input.checked) {
            formData[field] = input.value;
          }
        } else {
          formData[field] = input.value;
        }
      });
      console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ä¿å­˜:', formData);
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
    function restoreFormData() {
      const inputs = document.querySelectorAll('[data-field]');
      inputs.forEach(input => {
        const field = input.dataset.field;
        if (formData[field] !== undefined) {
          if (input.type === 'radio') {
            input.checked = (input.value === formData[field]);
          } else {
            input.value = formData[field];
          }
        }
      });

      // æ¡ä»¶åˆ†å²UIã‚‚æ›´æ–°
      toggleAccountingSoftware();
      toggleMfBusinessNumber();
      toggleChatworkEmail();

      console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ:', formData);
    }

    // éƒµä¾¿ç•ªå·æ¤œç´¢
    async function searchAddress(type) {
      const postal1Id = type === 'corp' ? 'corp-postal1' : 'rep-postal1';
      const postal2Id = type === 'corp' ? 'corp-postal2' : 'rep-postal2';
      const prefectureId = type === 'corp' ? 'corp-prefecture' : 'rep-prefecture';
      const address1Id = type === 'corp' ? 'corp-address1' : 'rep-address1';

      const postal1 = document.getElementById(postal1Id).value;
      const postal2 = document.getElementById(postal2Id).value;

      if (!postal1 || !postal2) {
        alert('éƒµä¾¿ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      const postalCode = postal1 + postal2;

      try {
        const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`);
        const data = await response.json();

        if (data.status === 200 && data.results) {
          const result = data.results[0];
          document.getElementById(prefectureId).value = result.address1;
          document.getElementById(address1Id).value = result.address2 + result.address3;
          alert('ä½æ‰€ã‚’è‡ªå‹•å…¥åŠ›ã—ã¾ã—ãŸã€‚');
        } else {
          alert('éƒµä¾¿ç•ªå·ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
        }
      } catch (error) {
        console.error('éƒµä¾¿ç•ªå·æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
        alert('éƒµä¾¿ç•ªå·æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // ä¼šè¨ˆã‚½ãƒ•ãƒˆä½¿ç”¨çŠ¶æ³ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function toggleAccountingSoftware() {
      const value = document.getElementById('accounting-software').value;
      const section = document.getElementById('software-detail-section');
      section.classList.toggle('hidden', value !== 'ä½¿ç”¨ã—ã¦ã„ã‚‹');
    }

    // ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰äº‹æ¥­è€…ç•ªå·ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function toggleMfBusinessNumber() {
      const softwareName = document.getElementById('software-name').value;
      const otherSection = document.getElementById('other-software-section');
      const mfSection = document.getElementById('mf-business-number-section');

      otherSection.classList.toggle('hidden', softwareName !== 'ãã®ä»–');
      mfSection.classList.toggle('hidden', softwareName !== 'ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰');
    }

    // Chatworkãƒ¡ãƒ¼ãƒ«ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function toggleChatworkEmail() {
      const chatworkUse = document.querySelector('input[name="chatwork-use"]:checked');
      const section = document.getElementById('chatwork-email-section');
      if (chatworkUse) {
        section.classList.toggle('hidden', chatworkUse.value !== 'ã‚ã‚Š');
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('lp2-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      // ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      saveCurrentFormData();

      hideError('form-error');

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!validateForm()) {
        showError('form-error', 'å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ä¿å­˜ä¸­...';

      try {
        // POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆapplication/x-www-form-urlencodedï¼‰
        const response = await fetch(GAS_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            action: 'saveLP2Data',
            sessionId: sessionId,
            data: JSON.stringify(formData)
          })
        });

        const data = await response.json();
        console.log('ä¿å­˜ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);

        if (data.success) {
          showSection('complete-section');
        } else {
          showError('form-error', data.message || 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
          submitBtn.disabled = false;
          submitBtn.textContent = 'ä¿å­˜ã™ã‚‹';
        }
      } catch (error) {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèªä¸­ï¼‰:', error);
        
        // CORSã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ç¢ºèªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
        console.log('ä¿å­˜ç¢ºèªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡...');
        
        try {
          // 2ç§’å¾…ã£ã¦ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚ŒãŸã‹ç¢ºèª
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          const checkUrl = `${GAS_API_URL}?action=getLP2FormData&sessionId=${encodeURIComponent(sessionId)}`;
          const checkResponse = await fetch(checkUrl, { method: 'GET' });
          const checkData = await checkResponse.json();
          
          console.log('ä¿å­˜ç¢ºèªçµæœ:', checkData);
          
          if (checkData.success && checkData.lp2Completed) {
            // ä¿å­˜ãŒç¢ºèªã§ããŸ â†’ å®Œäº†ç”»é¢ã¸
            console.log('âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç¢ºèªæˆåŠŸ');
            showSection('complete-section');
          } else {
            // ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ãªã„ â†’ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
            showError('form-error', 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            submitBtn.disabled = false;
            submitBtn.textContent = 'ä¿å­˜ã™ã‚‹';
          }
        } catch (checkError) {
          console.error('ä¿å­˜ç¢ºèªã‚¨ãƒ©ãƒ¼:', checkError);
          showError('form-error', 'ä¿å­˜ã®ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
          submitBtn.disabled = false;
          submitBtn.textContent = 'ä¿å­˜ã™ã‚‹';
        }
      }
    });

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateForm() {
      const isCorporate = document.getElementById('tab-corporate').classList.contains('active');

      // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒã‚§ãƒƒã‚¯
      const requiredFields = [
        'taxOffice',
        'repName', 'repNameKana', 'repTel1', 'repTel2', 'repTel3',
        'repPostal1', 'repPostal2', 'repPrefecture', 'repAddress1',
        'etaxId', 'etaxPassword',
        'accountingSoftware',
        'chatworkUse'
      ];

      // æ³•äººã®å ´åˆã®è¿½åŠ å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      if (isCorporate) {
        requiredFields.push(
          'corpName', 'corpNameKana', 'corpTel1', 'corpTel2', 'corpTel3',
          'corpPostal1', 'corpPostal2', 'corpPrefecture', 'corpAddress1',
          'eltaxId', 'eltaxPassword',
          'capital', 'fiscalMonth', 'officerCount'
        );
      }

      // å¾“æ¥­å“¡æ•°ã¯æ³•äººãƒ»å€‹äººå…±ã«å¿…é ˆ
      requiredFields.push('employeeCount');

      // ä¼šè¨ˆã‚½ãƒ•ãƒˆä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ
      if (formData.accountingSoftware === 'ä½¿ç”¨ã—ã¦ã„ã‚‹') {
        requiredFields.push('softwareName');
        if (formData.softwareName === 'ãã®ä»–') {
          requiredFields.push('otherSoftwareName');
        }
        if (formData.softwareName === 'ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰') {
          requiredFields.push('mfBusinessNumber');
        }
      }

      // Chatworkä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ
      if (formData.chatworkUse === 'ã‚ã‚Š') {
        requiredFields.push('chatworkEmail');
      }

      for (const field of requiredFields) {
        const value = formData[field];
        
        // æ•°å€¤å‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã¯0ã‚‚æœ‰åŠ¹
        if (field === 'employeeCount' || field === 'capital' || field === 'officerCount') {
          if (value === undefined || value === null || value === '') {
            console.log('Missing field:', field);
            return false;
          }
        } else {
          // æ–‡å­—åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
          if (!value || value.trim() === '') {
            console.log('Missing field:', field);
            return false;
          }
        }
      }

      return true;
    }
  </script>
</body>
</html>

