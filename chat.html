<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チャットボット - みんなの税務顧問</title>
    <meta name="description" content="チャットで気軽に税務相談。よくある質問にリアルタイムでお答えします。個人事業主・スタートアップ向け税務サービスのチャットサポート。">
    
    <!-- OGP Tags -->
    <meta property="og:title" content="チャットボット - みんなの税務顧問">
    <meta property="og:description" content="チャットで気軽に税務相談。よくある質問にリアルタイムでお答えします。個人事業主・スタートアップ向け税務サービスのチャットサポート。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://minzei-tax.com/chat">
    <meta property="og:image" content="https://minzei-tax.com/images/thumbnail.png">
    <meta name="twitter:card" content="summary_large_image">

    <link rel="icon" href="images/minzeikun.png" type="image/png">

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Noto+Serif+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Google Tag -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17411262353"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-17411262353');
    </script>
    
    <style>
    .page-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        padding: 80px 0 0 0;
    }
    
    .simulator-section {
        max-width: 1000px;
        margin: 0 auto 40px auto;
        padding: 0 20px;
    }
    
    .simulator-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        padding: 40px;
        margin-bottom: 40px;
    }
    
    .simulator-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .simulator-title {
        font-size: 2rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 15px;
    }
    
    .simulator-subtitle {
        font-size: 1.1rem;
        color: #6b7280;
        line-height: 1.6;
    }
    
    .simulator-form {
        display: grid;
        gap: 25px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .form-label {
        font-weight: 600;
        color: #374151;
        font-size: 1.1rem;
    }
    
    .form-input, .form-select {
        padding: 15px 20px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 1rem;
        transition: border-color 0.2s ease;
    }
    
    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #14b8a6;
    }
    
    .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 10px;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .checkbox-item:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .checkbox-item input[type="checkbox"] {
        margin: 0;
    }

    /* 新しい縦一列レイアウト用のスタイル */
    .form-help-text {
        font-size: 0.9rem;
        color: #6b7280;
        margin: 8px 0 15px 0;
        font-style: italic;
    }

    .checkbox-group-vertical {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 10px;
    }
    
    .checkbox-item-with-help {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 0;
        transition: all 0.2s ease;
    }
    
    .checkbox-item-with-help:hover {
        border-color: #14b8a6;
        box-shadow: 0 2px 8px rgba(20, 184, 166, 0.1);
    }
    
    .checkbox-item-enhanced {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        cursor: pointer;
        background: transparent;
        margin: 0;
        width: 100%;
        transition: background-color 0.2s ease;
    }
    
    .checkbox-item-enhanced:hover {
        background: #f8fafc;
    }
    
    .checkbox-text {
        flex: 1;
        margin-left: 12px;
        font-weight: 500;
        color: #374151;
    }
    
    .help-icon {
        background: #e0f2fe;
        border: 2px solid #0891b2;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
        margin-left: 15px;
    }
    
    .help-icon:hover {
        background: #0891b2;
        color: white;
        transform: scale(1.1);
    }
    
    .help-text {
        padding: 20px;
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border-top: 1px solid #e5e7eb;
        border-radius: 0 0 12px 12px;
        animation: slideDown 0.3s ease-out;
    }
    
    .help-text p {
        margin: 0 0 10px 0;
        color: #374151;
        line-height: 1.6;
    }
    
    .help-text p:last-child {
        margin-bottom: 0;
    }
    
    .help-text strong {
        color: #0891b2;
        display: block;
        margin-bottom: 8px;
    }
    
    .separator-line {
        height: 1px;
        background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
        margin: 10px 0;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        to {
            opacity: 1;
            max-height: 200px;
            padding-top: 20px;
            padding-bottom: 20px;
        }
    }
    
    .simulate-btn {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        color: white;
        border: none;
        padding: 18px 40px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease;
        margin-top: 20px;
    }
    
    .simulate-btn:hover {
        transform: translateY(-2px);
    }
    
    .result-card {
        background: linear-gradient(135deg, #f0fdfa, #e6fffa);
        border: 2px solid #14b8a6;
        border-radius: 16px;
        padding: 30px;
        margin-top: 30px;
        display: none;
    }
    
    .result-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #065f46;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .result-content {
        font-size: 1.1rem;
        color: #374151;
        line-height: 1.8;
        margin-bottom: 25px;
    }
    
    .result-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .result-btn {
        display: inline-block;
        padding: 12px 25px;
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: transform 0.2s ease;
    }
    
    .result-btn:hover {
        transform: translateY(-2px);
    }
    
    .result-btn.secondary {
        background: linear-gradient(135deg, #6b7280, #4b5563);
    }
    
    .chat-wrapper {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
        height: calc(100vh - 200px);
        min-height: 600px;
        display: flex;
        flex-direction: column;
    }
    
    .chat-header {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
    }
    
    .chat-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
    }
    
    .chat-subtitle {
        font-size: 0.9rem;
        margin: 5px 0 0 0;
        opacity: 0.9;
    }
    
    .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f8fafc;
    }
    
    .message {
        margin-bottom: 20px;
        animation: fadeInUp 0.3s ease-out;
    }
    
    .message.bot {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }
    
    .message.user {
        display: flex;
        justify-content: flex-end;
    }
    
    .bot-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 18px;
        flex-shrink: 0;
    }
    
    .message-content {
        background: white;
        padding: 15px 20px;
        border-radius: 20px;
        max-width: 70%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        position: relative;
    }
    
    .message.bot .message-content {
        border-bottom-left-radius: 8px;
        margin-left: 0;
    }
    
    .message.user .message-content {
        background: linear-gradient(135deg, #0891b2, #0e7490);
        color: white;
        border-bottom-right-radius: 8px;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: #64748b;
        margin-top: 8px;
        opacity: 0.8;
        font-weight: 500;
    }
    
    .message.user .message-time {
        color: rgba(255, 255, 255, 0.8);
    }
    
    .suggested-questions {
        padding: 15px 20px;
        background: white;
        border-top: 1px solid #e2e8f0;
    }
    
    .suggestions-title {
        font-size: 0.9rem;
        color: #64748b;
        margin-bottom: 10px;
        font-weight: 500;
    }
    
    .suggestion-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .suggestion-chip {
        background: #f1f5f9;
        border: 1px solid #e2e8f0;
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s ease;
        color: #334155;
    }
    
    .suggestion-chip:hover {
        background: #e2e8f0;
        border-color: #14b8a6;
        color: #14b8a6;
    }
    
    .chat-input-area {
        padding: 20px;
        background: white;
        border-top: 1px solid #e2e8f0;
    }
    
    .input-wrapper {
        display: flex;
        gap: 12px;
        align-items: flex-end;
    }
    
    .chat-input {
        flex: 1;
        border: 2px solid #e2e8f0;
        border-radius: 25px;
        padding: 15px 20px;
        font-size: 1rem;
        resize: none;
        outline: none;
        transition: border-color 0.2s ease;
        font-family: inherit;
        max-height: 120px;
        min-height: 50px;
    }
    
    .chat-input:focus {
        border-color: #14b8a6;
    }
    
    .send-button {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
        font-size: 20px;
    }
    
    .send-button:hover {
        transform: scale(1.05);
    }
    
    .send-button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
        transform: none;
    }
    
    .typing-indicator {
        display: none;
        padding: 15px 20px;
        background: white;
        border-radius: 20px;
        border-bottom-left-radius: 8px;
        max-width: 100px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .typing-dots {
        display: flex;
        gap: 4px;
    }
    
    .typing-dot {
        width: 8px;
        height: 8px;
        background: #94a3b8;
        border-radius: 50%;
        animation: typingDot 1.5s infinite;
    }
    
    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    .welcome-message {
        text-align: center;
        padding: 40px 20px;
        background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
        border-radius: 16px;
        margin: 20px;
        color: #0f172a;
    }
    
    .welcome-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: #0f172a;
    }
    
    .quick-start-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 20px;
    }
    
    .quick-start-btn {
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        font-size: 0.9rem;
        color: #334155;
    }
    
    .quick-start-btn:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
        color: #14b8a6;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes typingDot {
        0%, 20% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.2);
            opacity: 0.7;
        }
        80%, 100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
        .page-container {
            padding: 60px 10px 0 10px;
        }
        
        .simulator-card {
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .simulator-title {
            font-size: 1.5rem;
        }
        
        .chat-wrapper {
            height: calc(100vh - 100px);
            border-radius: 12px;
        }
        
        .message-content {
            max-width: 85%;
        }
        
        .quick-start-buttons {
            grid-template-columns: 1fr;
        }
        
        .suggestion-chips {
            justify-content: center;
        }
        
        .chat-title {
            font-size: 1.2rem;
        }
        
        .checkbox-group {
            flex-direction: column;
        }
        
        .help-icon {
            width: 24px;
            height: 24px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .checkbox-item-enhanced {
            padding: 12px 15px;
        }
        
        .help-text {
            padding: 15px;
        }
        
        .result-actions {
            flex-direction: column;
        }
    }
    
    @media (max-width: 480px) {
        .page-container {
            padding: 60px 5px 0 5px;
        }
        
        .simulator-card {
            padding: 20px;
        }
        
        .chat-wrapper {
            height: calc(100vh - 80px);
        }
        
        .chat-messages {
            padding: 15px;
        }
        
        .chat-input-area {
            padding: 15px;
        }
        
        .message-content {
            max-width: 90%;
            padding: 12px 15px;
        }
    }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <h1><a href="/">みんなの税務顧問</a></h1>
                </div>
                
                <!-- Desktop Navigation -->
                <nav class="nav-desktop">
                    <a href="/#services" class="nav-link">サービス内容</a>
                    <a href="/#plans" class="nav-link">料金</a>
                    <a href="/#cost-comparison" class="nav-link">コスト比較</a>
                </nav>
                
                <!-- Desktop CTA Button -->
                <div class="cta-desktop">
                    <a href="/#contact" class="btn btn-primary">申込はこちら</a>
                </div>
                
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="メニューを開く">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- Mobile Menu -->
                <nav class="mobile-menu" id="mobileMenu">
                    <a href="/#services" class="mobile-nav-link">サービス内容</a>
                    <a href="/#plans" class="mobile-nav-link">料金</a>
                    <a href="/#cost-comparison" class="mobile-nav-link">コスト比較</a>
                    <a href="/#contact" class="btn btn-primary mobile-cta">申込はこちら</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Page Container -->
    <section class="page-container">
        <div class="container">
            <!-- Plan Simulator Section -->
            <div class="simulator-section">
                <div class="simulator-card">
                    <div class="simulator-header">
                        <h1 class="simulator-title">📊 料金プランシミュレーション</h1>
                        <p class="simulator-subtitle">あなたの事業状況に最適なプランをご提案いたします。<br>簡単な質問にお答えいただくだけで、最適なプランが分かります。</p>
                    </div>
                    
                    <form class="simulator-form" id="simulatorForm">
                        <div class="form-group">
                            <label class="form-label">📈 年間売上高（予想）</label>
                            <select class="form-select" id="annualRevenue" required>
                                <option value="">選択してください</option>
                                <option value="under500">500万円未満</option>
                                <option value="500-1000">500万円〜1,000万円未満</option>
                                <option value="1000-3000">1,000万円超〜3,000万円</option>
                                <option value="over3000">3,000万円超</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">🏢 事業形態</label>
                            <select class="form-select" id="businessType" required>
                                <option value="">選択してください</option>
                                <option value="individual">個人事業主</option>
                                <option value="corporation">法人</option>
                                <option value="considering">法人化を検討中</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">📋 該当する項目をすべて選択してください</label>
                            <p class="form-help-text">※ 消費税申告が必要かどうかを判定するために必要な情報です</p>
                            <div class="checkbox-group-vertical">
                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="invoiceRegistered" value="invoice">
                                        <span class="checkbox-text">インボイス発行事業者として登録済み</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('invoice-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="invoice-help" style="display: none;">
                                        <p><strong>📋 インボイス発行事業者とは？</strong></p>
                                        <p>適格請求書（インボイス）を発行できる事業者として税務署に登録している事業者のことです。2023年10月から始まったインボイス制度に対応するため、多くの事業者が登録しています。登録済みの場合は自動的に消費税の課税事業者となります。</p>
                                    </div>
                                </div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="over1000Before" value="over1000_before">
                                        <span class="checkbox-text">2年前の売上が1,000万円を超えている</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('before-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="before-help" style="display: none;">
                                        <p><strong>📊 基準期間とは？</strong></p>
                                        <p>2年前の1年間を「基準期間」と呼びます。例えば、2024年分の申告であれば2022年の売上が対象です。基準期間の課税売上高が1,000万円を超えている場合、消費税の課税事業者となります。</p>
                                    </div>
                                </div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="over1000Recent" value="over1000_recent">
                                        <span class="checkbox-text">前年前半6ヶ月の売上が1,000万円を超えている</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('recent-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="recent-help" style="display: none;">
                                        <p><strong>📅 特定期間とは？</strong></p>
                                        <p>前年の1月から6月までの6ヶ月間を「特定期間」と呼びます。この期間の課税売上高または給与支払額のいずれかが1,000万円を超えている場合、消費税の課税事業者となります。</p>
                                    </div>
                                </div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="voluntaryTaxable" value="voluntary">
                                        <span class="checkbox-text">任意で課税事業者を選択している</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('voluntary-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="voluntary-help" style="display: none;">
                                        <p><strong>✋ 任意の課税事業者選択とは？</strong></p>
                                        <p>売上が1,000万円以下でも、自ら選択して消費税の課税事業者になることができます。「消費税課税事業者選択届出書」を税務署に提出している場合がこれに該当します。設備投資で消費税の還付を受けたい場合などに選択します。</p>
                                    </div>
                                </div>

                                <div class="separator-line"></div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="blueReturn" value="blue_return">
                                        <span class="checkbox-text">青色申告を希望</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('blue-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="blue-help" style="display: none;">
                                        <p><strong>💙 青色申告とは？</strong></p>
                                        <p>帳簿をきちんとつけることを条件に、税制上の特典を受けられる申告方法です。65万円の特別控除や家族への給与の経費算入などのメリットがあります。事前に「青色申告承認申請書」の提出が必要です。</p>
                                    </div>
                                </div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="cryptoFx" value="crypto_fx">
                                        <span class="checkbox-text">暗号資産・仮想通貨のFXでの利益がある</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('crypto-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="crypto-help" style="display: none;">
                                        <p><strong>₿ 暗号資産・仮想通貨の税務とは？</strong></p>
                                        <p>ビットコインなどの暗号資産の売買やFX取引で得た利益は、原則として雑所得となり確定申告が必要です。取引の記録をしっかり残しておくことが重要です。年間売上が1,000万円未満であれば当サービスで対応可能です。</p>
                                    </div>
                                </div>

                                <div class="checkbox-item-with-help">
                                    <label class="checkbox-item-enhanced">
                                        <input type="checkbox" id="reselling" value="reselling">
                                        <span class="checkbox-text">せどり・輸入・転売での利益がある</span>
                                        <button type="button" class="help-icon" onclick="toggleHelp('reselling-help')">❓</button>
                                    </label>
                                    <div class="help-text" id="reselling-help" style="display: none;">
                                        <p><strong>📦 せどり・転売ビジネスとは？</strong></p>
                                        <p>商品を仕入れて販売する事業のことです。Amazon、メルカリ、eBayなどでの販売も含まれます。継続的に行っている場合は事業所得となり、確定申告が必要です。年間売上が1,000万円未満であれば当サービスで対応可能です。</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">📝 月間取引件数（予想）</label>
                            <select class="form-select" id="monthlyTransactions">
                                <option value="">選択してください</option>
                                <option value="under50">50件未満</option>
                                <option value="50-100">50〜100件</option>
                                <option value="100-200">100〜200件</option>
                                <option value="over200">200件以上</option>
                            </select>
                        </div>

                        <button type="submit" class="simulate-btn">💡 最適なプランを診断する</button>
                    </form>

                    <div class="result-card" id="resultCard">
                        <div class="result-title" id="resultTitle"></div>
                        <div class="result-content" id="resultContent"></div>
                        <div class="result-actions" id="resultActions"></div>
                    </div>
                </div>
            </div>

            <!-- Chatbot Container -->
            <div class="chat-wrapper">
                <!-- Chat Header -->
                <div class="chat-header">
                    <h2 class="chat-title">💬 みんなの税務顧問 チャットサポート</h2>
                    <p class="chat-subtitle">税務に関するご質問にお答えします</p>
                </div>
                
                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome Message -->
                    <div class="welcome-message" id="welcomeMessage">
                        <h3 class="welcome-title">🎉 チャットサポートへようこそ！</h3>
                        <p>税務に関するご質問やサービスについて、お気軽にお聞きください。<br>
                        よくあるご質問から選んでいただくか、直接メッセージを入力してください。</p>
                        
                        <div class="quick-start-buttons">
                            <div class="quick-start-btn" onclick="sendQuickQuestion('サービス内容を教えて')">
                                📋 サービス内容
                            </div>
                            <div class="quick-start-btn" onclick="sendQuickQuestion('料金について教えて')">
                                💰 料金について
                            </div>
                            <div class="quick-start-btn" onclick="sendQuickQuestion('契約期間について')">
                                📝 契約について
                            </div>
                            <div class="quick-start-btn" onclick="sendQuickQuestion('確定申告について')">
                                📊 確定申告
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Typing Indicator -->
                <div class="message bot" id="typingIndicator" style="display: none;">
                    <div class="bot-avatar">AI</div>
                    <div class="typing-indicator">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Suggested Questions -->
                <div class="suggested-questions" id="suggestedQuestions">
                    <div class="suggestions-title">💡 よくあるご質問</div>
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" onclick="sendQuickQuestion('他の税理士事務所との違いは？')">他社との違い</div>
                        <div class="suggestion-chip" onclick="sendQuickQuestion('領収書の撮影方法は？')">領収書撮影</div>
                        <div class="suggestion-chip" onclick="sendQuickQuestion('消費税申告が必要か？')">消費税申告</div>
                        <div class="suggestion-chip" onclick="sendQuickQuestion('青色申告をしたい')">青色申告</div>
                        <div class="suggestion-chip" onclick="sendQuickQuestion('電話で相談したい')">電話相談</div>
                    </div>
                </div>
                
                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <textarea 
                            class="chat-input" 
                            id="chatInput" 
                            placeholder="メッセージを入力してください..."
                            rows="1"
                            onkeydown="handleInputKeydown(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button class="send-button" id="sendButton" onclick="sendMessage()">
                            ➤
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // FAQ データベース（拡充版）
        const faqDatabase = {
            // サービスについて
            "どのようなサービス": {
                answer: "年商1,000万円以下の個人事業主やスタートアップの方向けに、AIを活用し低価格で税務顧問サービスを提供しています。チャットでの税務相談、記帳代行、確定申告のサポートを主なサービスとしています。",
                category: "サービス"
            },
            "サービス内容": {
                answer: "主に以下のサービスを提供しています：\n\n• Chatworkでの税務相談\n• 記帳代行\n• 確定申告書または決算申告書の作成・提出\n• 節税や資金繰りに関する情報提供\n\n月額980円（税込）から利用できる、小規模事業者特化のサービスです。",
                category: "サービス"
            },
            "他の税理士事務所との違い": {
                answer: "最新AIの活用により、月額980円（税込）からという圧倒的な低価格を実現している点が最大の特徴です。小規模事業者に特化することで、手厚いサポートを提供しています。",
                category: "サービス"
            },
            "AIが対応": {
                answer: "いいえ、ご相談にはAIではなく、担当者が直接対応いたしますのでご安心ください。AIは業務効率化のために活用していますが、お客様との相談は人が対応します。",
                category: "サービス"
            },

            // 新規追加FAQ
            "領収書の撮影": {
                answer: "スマートフォンで撮影、またはスキャンしたデータで撮影をしてください。撮影後は、こちらからお渡しするGoogleドライブの専用フォルダに保存していただきます。鮮明に写るよう、明るい場所で撮影をお願いいたします。",
                category: "サービス"
            },
            "領収書撮影": {
                answer: "スマートフォンで撮影、またはスキャンしたデータで撮影をしてください。撮影後は、こちらからお渡しするGoogleドライブの専用フォルダに保存していただきます。鮮明に写るよう、明るい場所で撮影をお願いいたします。",
                category: "サービス"
            },
            "決済されない": {
                answer: "申し訳ございませんが、ご契約・決済完了後にChatworkでの税務相談サービスをご利用いただけます。まずはお申し込み手続きを完了していただき、決済確認後にサービスを開始させていただきます。",
                category: "契約"
            },
            "チャット不可": {
                answer: "申し訳ございませんが、ご契約・決済完了後にChatworkでの税務相談サービスをご利用いただけます。まずはお申し込み手続きを完了していただき、決済確認後にサービスを開始させていただきます。",
                category: "契約"
            },
            "消費税申告": {
                answer: "消費税の申告が必要になるのは、主に次のいずれかに当てはまる「課税事業者」です：\n\n• インボイス発行事業者（適格請求書発行事業者）の登録をしている\n• 2年前（基準期間）の課税売上高が1,000万円を超えている\n• 前年の前半6ヶ月（特定期間）の課税売上高または給与支払額が1,000万円を超えている\n• 任意で課税事業者になることを選択している\n\nどちらのタイプに該当するか、お気軽にご相談ください。",
                category: "申告"
            },
            "消費税": {
                answer: "消費税の申告が必要になるのは、主に次のいずれかに当てはまる「課税事業者」です：\n\n• インボイス発行事業者（適格請求書発行事業者）の登録をしている\n• 2年前（基準期間）の課税売上高が1,000万円を超えている\n• 前年の前半6ヶ月（特定期間）の課税売上高または給与支払額が1,000万円を超えている\n• 任意で課税事業者になることを選択している\n\nどちらのタイプに該当するか、お気軽にご相談ください。",
                category: "申告"
            },
            "日割り": {
                answer: "申し訳ございませんが、日割り計算での料金設定はございません。月額制でのご契約となります。ご契約月の途中からでも、1ヶ月分の料金をお支払いいただく形となります。",
                category: "料金"
            },
            "青色申告": {
                answer: "青色申告の申請につきましては、ご自身で税務署へお手続きをお願いいたします。申請書の書き方や手続きについてのご質問は、Chatworkにてサポートさせていただきます。",
                category: "申告"
            },
            "青色申告をしたい": {
                answer: "青色申告の申請につきましては、ご自身で税務署へお手続きをお願いいたします。申請書の書き方や手続きについてのご質問は、Chatworkにてサポートさせていただきます。",
                category: "申告"
            },
            "申請関連": {
                answer: "各種税務署への申請手続きにつきましては、ご自身でお手続きをお願いいたします。申請書の記載方法や手続きの流れについては、Chatworkにてサポートいたします。",
                category: "その他"
            },
            "古物商": {
                answer: "古物商の届出につきましては、ご自身で警察署へお手続きをお願いいたします。古物商に関する税務上の取り扱いについては、Chatworkにてご相談いただけます。",
                category: "その他"
            },
            "マネーフォワード": {
                answer: "マネーフォワードからfreeeへの変更、またはその逆の変更も可能です。会計ソフトの変更をご希望の場合は、データ移行の方法や設定についてサポートいたします。",
                category: "サービス"
            },
            "freee": {
                answer: "freeeからマネーフォワードへの変更、またはその逆の変更も可能です。会計ソフトの変更をご希望の場合は、データ移行の方法や設定についてサポートいたします。",
                category: "サービス"
            },
            "電話したい": {
                answer: "申し訳ございませんが、お電話でのサポートは行っておりません。ご質問・ご相談は、こちらのチャットボットまたはご契約後のChatworkにてお受けしております。より効率的にサポートをご提供するため、テキストベースでのやり取りをお願いしております。",
                category: "サービス"
            },
            "電話": {
                answer: "申し訳ございませんが、お電話でのサポートは行っておりません。ご質問・ご相談は、こちらのチャットボットまたはご契約後のChatworkにてお受けしております。より効率的にサポートをご提供するため、テキストベースでのやり取りをお願いしております。",
                category: "サービス"
            },
            "メール": {
                answer: "申し訳ございませんが、メールでのサポートは行っておりません。ご質問・ご相談は、こちらのチャットボットまたはご契約後のChatworkにてお受けしております。すべてのお問い合わせはチャットベースで承っております。",
                category: "サービス"
            },
            "銀行口座": {
                answer: "銀行口座やクレジットカードの連携は、クラウド会計ソフト（マネーフォワードまたはfreee）で連携をしていただきます。連携方法についてはChatworkにてサポートいたします。",
                category: "サービス"
            },
            "クレジットカード": {
                answer: "銀行口座やクレジットカードの連携は、クラウド会計ソフト（マネーフォワードまたはfreee）で連携をしていただきます。連携方法についてはChatworkにてサポートいたします。",
                category: "サービス"
            },
            "暗号資産": {
                answer: "暗号資産・仮想通貨のFXで利益が出た場合、年間売上が1,000万円未満であれば、こちらのサービスでご対応可能です。暗号資産の税務処理についてもサポートいたします。",
                category: "申告"
            },
            "仮想通貨": {
                answer: "暗号資産・仮想通貨のFXで利益が出た場合、年間売上が1,000万円未満であれば、こちらのサービスでご対応可能です。暗号資産の税務処理についてもサポートいたします。",
                category: "申告"
            },
            "せどり": {
                answer: "せどり・輸入・転売で利益がある場合、年間売上が1,000万円以下であればサービス対象となります。物販事業の税務処理についてもサポートいたします。",
                category: "申告"
            },
            "転売": {
                answer: "せどり・輸入・転売で利益がある場合、年間売上が1,000万円以下であればサービス対象となります。物販事業の税務処理についてもサポートいたします。",
                category: "申告"
            },
            "輸入": {
                answer: "せどり・輸入・転売で利益がある場合、年間売上が1,000万円以下であればサービス対象となります。物販事業の税務処理についてもサポートいたします。",
                category: "申告"
            },

            // 既存のFAQ
            "googleドライブ": {
                answer: "ご契約後に、お客様専用のGoogleドライブフォルダを作成し、アクセス権限を付与いたします。こちらのフォルダに領収書やレシート、その他の資料をアップロードしていただければ、担当者が確認して記帳代行を行います。フォルダは整理された構造になっており、月別・カテゴリ別に保存していただけます。",
                category: "サービス"
            },
            "資料共有": {
                answer: "資料共有はGoogleドライブを使用します。ご契約後に、お客様専用のフォルダへのアクセス権限を付与いたします。領収書、レシート、請求書、銀行通帳のコピーなど、必要な資料をスマートフォンで撮影またはスキャンして、指定フォルダにアップロードしてください。",
                category: "サービス"
            },
            "1000万円": {
                answer: "「みんなの税務顧問」は年商1,000万円未満の事業者様を対象としたサービスです。ご契約前から1,000万円を超える見込みの場合や、ご契約期間の途中で年商が1,000万円を超えた場合は、運営母体である「ソルビス税理士法人」とのご契約に切り替えて、引き続きサポートさせていただきます。",
                category: "サービス"
            },
            "対面": {
                answer: "基本的にはChatworkでのやり取りとなり、対面やオンラインでの面談は行っておりません。日常的なご相談やご質問は、Chatworkを通じて担当者が直接対応いたします。業務を効率化することでお手頃な価格を実現しております。",
                category: "サービス"
            },
            "chatwork": {
                answer: "はい、ご契約後はChatworkを使用してやり取りをさせていただきます。Chatworkアカウントをお持ちでない場合は、無料でアカウント作成が可能です。担当者が専用のグループチャットを作成し、税務相談から日常的なコミュニケーションまで、すべてChatwork上で行います。",
                category: "サービス"
            },
            "チャットワーク": {
                answer: "はい、ご契約後はChatworkを使用してやり取りをさせていただきます。Chatworkアカウントをお持ちでない場合は、無料でアカウント作成が可能です。担当者が専用のグループチャットを作成し、税務相談から日常的なコミュニケーションまで、すべてChatwork上で行います。",
                category: "サービス"
            },

            // 料金について
            "料金": {
                answer: "料金は以下の通りです：\n\n• 月額顧問料: 980円（税込）\n• 月間記帳代行料: 2,980円～（税込）/100件あたり\n• 申告料: 39,800円（税込）\n• 消費税申告料: 29,800円（税込）※別途\n• 月間会計システム料: 980円（税込）\n\n詳細な料金については、ウェブサイトをご確認ください。",
                category: "料金"
            },
            "契約期間": {
                answer: "はい、初回のご契約から1年間の最低利用期間が設定されています。期間満了の7日前までに解約のお申し出がない場合、12ヶ月ごとに自動で更新されます。",
                category: "契約"
            },
            "途中解約": {
                answer: "最低利用期間内に解約される場合、残りの期間分の利用料金に相当する金額を違約金としてお支払いいただく必要があり、返金はございません。",
                category: "契約"
            },
            "支払い方法": {
                answer: "ご契約時に、基本料金・記帳代行料金・会計ソフト使用料の1年分と、申告料の合計額を前払いでお支払いいただきます。",
                category: "契約"
            },

            // 申告について
            "申告": {
                answer: "期限内に申告を完了させるため、以下の期限までにご契約をお願いしております：\n\n• 個人事業主の方（確定申告）：確定申告の期日（原則3月15日）の1ヶ月前まで\n• 法人の方（決算申告）：法人の決算月の1ヶ月前まで\n\n例：12月決算の法人の場合、11月末までのご契約が必要です。",
                category: "申告"
            },
            "確定申告": {
                answer: "期限内に申告を完了させるため、確定申告の期日（原則3月15日）の1ヶ月前までにご契約をお願いしております。上記の期限を過ぎてからのご契約の場合、期限内の申告をお受けできない可能性がございます。",
                category: "申告"
            },

            // その他
            "運営会社": {
                answer: "ソルビス税理士法人が運営しております。",
                category: "その他"
            }
        };

        let chatHistory = [];
        let isTyping = false;

        // プランシミュレーション機能
        document.getElementById('simulatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const annualRevenue = formData.get('annualRevenue');
            const businessType = formData.get('businessType');
            const monthlyTransactions = formData.get('monthlyTransactions');
            
            // チェックボックスの取得
            const checkboxes = {
                invoice: document.getElementById('invoiceRegistered').checked,
                over1000Before: document.getElementById('over1000Before').checked,
                over1000Recent: document.getElementById('over1000Recent').checked,
                voluntary: document.getElementById('voluntaryTaxable').checked,
                blueReturn: document.getElementById('blueReturn').checked,
                cryptoFx: document.getElementById('cryptoFx').checked,
                reselling: document.getElementById('reselling').checked
            };
            
            const result = calculatePlan(annualRevenue, businessType, monthlyTransactions, checkboxes);
            displayResult(result);
        });

        function calculatePlan(revenue, businessType, transactions, checkboxes) {
            // 年間売上が1000万円を超える場合は自動的にソルビス税理士法人への斡旋
            if (revenue === '1000-3000' || revenue === 'over3000') {
                return {
                    type: 'solvis',
                    title: '🏢 ソルビス税理士法人をご紹介いたします',
                    content: `年間売上が1,000万円を超える事業者様には、「みんなの税務顧問」ではなく、より専門的なサポートが可能な「ソルビス税理士法人」でのご契約をおすすめいたします。\n\n✅ より高度な税務相談\n✅ 法人化支援\n✅ 節税対策の提案\n✅ 事業拡大に向けたアドバイス\n✅ 大規模事業に対応した専門サービス`,
                    actions: [
                        { text: 'ソルビス税理士法人に相談', url: 'https://www.solvis-tax.com/', primary: true },
                        { text: 'みんなの税務顧問について詳しく', url: '/', primary: false }
                    ]
                };
            }

            // 消費税申告が必要かチェック
            const needsConsumptionTax = checkboxes.invoice || checkboxes.over1000Before || 
                                     checkboxes.over1000Recent || checkboxes.voluntary;

            // プラン判定
            if (needsConsumptionTax) {
                return {
                    type: 'consumption_tax',
                    title: '📊 消費税申告プランがおすすめです',
                    content: `あなたの事業状況では消費税の申告が必要です。消費税申告に対応したプランをご提案いたします。\n\n• 年払い: 月額10,740円（年間128,880円）\n• 月払い: 月額12,300円（年間147,600円）\n\n年払いプランなら約12%お得になります！`,
                    actions: [
                        { text: '消費税申告プランを見る', url: '/cost.tax', primary: true },
                        { text: '詳しい料金を確認', url: '/cost', primary: false }
                    ]
                };
            } else {
                return {
                    type: 'standard',
                    title: '💰 通常プランがおすすめです',
                    content: `あなたの事業状況に最適な通常プランをおすすめいたします。\n\n• 年払い: 月額8,256円（年間99,080円）\n• 月払い: 月額9,800円（年間117,600円）\n\n年払いプランなら約15%お得になります！${checkboxes.blueReturn ? '\n\n※青色申告の申請は、ご自身で税務署にお手続きをお願いいたします。申請方法についてはサポートいたします。' : ''}`,
                    actions: [
                        { text: '通常プランを見る', url: '/cost', primary: true },
                        { text: 'お申し込み', url: '/#contact', primary: true }
                    ]
                };
            }
        }

        function displayResult(result) {
            const resultCard = document.getElementById('resultCard');
            const resultTitle = document.getElementById('resultTitle');
            const resultContent = document.getElementById('resultContent');
            const resultActions = document.getElementById('resultActions');

            resultTitle.textContent = result.title;
            resultContent.innerHTML = result.content.replace(/\n/g, '<br>');
            
            resultActions.innerHTML = '';
            result.actions.forEach(action => {
                const button = document.createElement('a');
                button.href = action.url;
                button.className = `result-btn ${action.primary ? '' : 'secondary'}`;
                button.textContent = action.text;
                if (action.url.startsWith('http')) {
                    button.target = '_blank';
                    button.rel = 'noopener noreferrer';
                }
                resultActions.appendChild(button);
            });

            resultCard.style.display = 'block';
            resultCard.scrollIntoView({ behavior: 'smooth' });
        }

        // チャット初期化
        function initializeChat() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // 入力欄にフォーカス
            document.getElementById('chatInput').focus();
        }

        // メッセージ送信
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message === '' || isTyping) return;
            
            // ウェルカムメッセージを非表示
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
            
            // ユーザーメッセージを表示
            addMessage('user', message);
            input.value = '';
            autoResize(input);
            
            // ボットの返答を生成
            generateBotResponse(message);
            
            // チャット履歴に追加
            chatHistory.push({
                type: 'user',
                message: message,
                timestamp: new Date()
            });
        }

        // クイック質問送信
        function sendQuickQuestion(question) {
            const input = document.getElementById('chatInput');
            input.value = question;
            sendMessage();
        }

        // メッセージ追加
        function addMessage(type, content, showTime = true) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (type === 'bot') {
                messageDiv.innerHTML = `
                    <div class="bot-avatar">AI</div>
                    <div class="message-content">
                        ${content.replace(/\n/g, '<br>')}
                        ${showTime ? `<div class="message-time">${timeString}</div>` : ''}
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        ${content.replace(/\n/g, '<br>')}
                        ${showTime ? `<div class="message-time">${timeString}</div>` : ''}
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ボットの返答生成
        function generateBotResponse(userMessage) {
            isTyping = true;
            
            // タイピングインジケーター表示
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const response = findBestResponse(userMessage);
                addMessage('bot', response);
                
                // チャット履歴に追加
                chatHistory.push({
                    type: 'bot',
                    message: response,
                    timestamp: new Date()
                });
                
                isTyping = false;
            }, 1000 + Math.random() * 1000); // 1-2秒のランダム遅延
        }

        // 最適な返答を検索
        function findBestResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // キーワードマッチング
            for (const [key, value] of Object.entries(faqDatabase)) {
                if (message.includes(key.toLowerCase())) {
                    return value.answer;
                }
            }
            
            // 部分マッチング
            if (message.includes('サービス') || message.includes('何')) {
                return faqDatabase["サービス内容"].answer;
            }
            if (message.includes('料金') || message.includes('値段') || message.includes('費用')) {
                return faqDatabase["料金"].answer;
            }
            if (message.includes('契約') || message.includes('期間')) {
                return faqDatabase["契約期間"].answer;
            }
            if (message.includes('解約') || message.includes('やめ')) {
                return faqDatabase["途中解約"].answer;
            }
            if (message.includes('申告') || message.includes('確定申告')) {
                return faqDatabase["確定申告"].answer;
            }
            if (message.includes('会社') || message.includes('運営')) {
                return faqDatabase["運営会社"].answer;
            }
            
            // デフォルト返答
            return `ご質問ありがとうございます。\n\n申し訳ございませんが、お問い合わせの内容について詳細な回答を見つけることができませんでした。\n\n以下のような質問にお答えできます：\n• サービス内容について\n• 料金について\n• 契約・解約について\n• 確定申告について\n• その他のよくあるご質問\n\nより具体的なご質問をいただければ、詳しくお答えできます。\n\nまた、直接のご相談をご希望の場合は、ホームページの「申込はこちら」からお申し込みください。`;
        }

        // タイピングインジケーター表示
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const messagesContainer = document.getElementById('chatMessages');
            indicator.style.display = 'flex';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // タイピングインジケーター非表示
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'none';
        }

        // 入力欄の自動リサイズ
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // キーボードイベント処理
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // 説明文の表示/非表示を切り替える関数
        function toggleHelp(helpId) {
            const helpElement = document.getElementById(helpId);
            if (helpElement.style.display === 'none' || helpElement.style.display === '') {
                helpElement.style.display = 'block';
            } else {
                helpElement.style.display = 'none';
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
        });
    </script>

    <script src="script.js"></script>
</body>
</html>