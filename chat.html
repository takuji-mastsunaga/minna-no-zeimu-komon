<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>料金プランシミュレーション - みんなの税務顧問</title>
    <meta name="description" content="あなたの事業状況に最適な料金プランをご提案いたします。簡単な質問にお答えいただくだけで、最適なプランが分かります。">
    
    <!-- OGP Tags -->
    <meta property="og:title" content="料金プランシミュレーション - みんなの税務顧問">
    <meta property="og:description" content="あなたの事業状況に最適な料金プランをご提案いたします。簡単な質問にお答えいただくだけで、最適なプランが分かります。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://minzei-tax.com/chat">
    <meta property="og:image" content="https://minzei-tax.com/images/thumbnail.png">
    <meta name="twitter:card" content="summary_large_image">

    <link rel="icon" href="images/minzeikun.png" type="image/png">

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Noto+Serif+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Google Tag -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17411262353"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-17411262353');
    </script>
    
    <style>
    .page-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        padding: 80px 0 40px 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .simulator-wrapper {
        max-width: 800px;
        width: 100%;
        padding: 0 20px;
    }
    
    .page-title-section {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin: 0;
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .step-container {
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        padding: 60px 50px;
        text-align: center;
        position: relative;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: all 0.5s ease;
    }
    
    .step-header {
        margin-bottom: 40px;
    }
    
    .step-number {
        position: absolute;
        top: 20px;
        right: 30px;
        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        color: #9ca3af;
        font-size: 4rem;
        font-weight: 700;
        padding: 10px 20px;
        border-radius: 12px;
        opacity: 0.3;
        z-index: 1;
    }
    
    .step-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 30px auto;
        font-size: 2rem;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .step-title {
        font-size: 2.2rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 20px;
        line-height: 1.3;
    }
    
    .step-description {
        font-size: 1.1rem;
        color: #6b7280;
        margin-bottom: 40px;
        line-height: 1.6;
    }
    
    .options-grid {
        display: grid;
        gap: 15px;
        margin-bottom: 40px;
    }
    
    .option-item {
        background: #f8fafc;
        border: 3px solid #e2e8f0;
        border-radius: 16px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 1.1rem;
        color: #374151;
    }
    
    .option-item:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(20, 184, 166, 0.15);
    }
    
    .option-item.selected {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        border-color: #14b8a6;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(20, 184, 166, 0.3);
        position: relative;
    }
    
    .option-item.selected:hover {
        background: linear-gradient(135deg, #0f766e, #0e7490);
        border-color: #0f766e;
        box-shadow: 0 8px 25px rgba(15, 118, 110, 0.4);
    }
    
    .option-item.selected::after {
        content: '✓ 選択済み（クリックで解除）';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.75rem;
        opacity: 0;
        transition: opacity 0.3s ease;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        white-space: nowrap;
    }
    
    .option-item.selected:hover::after {
        opacity: 1;
        content: '❌ クリックで選択解除';
        background: rgba(15, 118, 110, 0.9);
    }
    
    /* 2カラムレイアウト用 */
    .options-grid.two-column {
        grid-template-columns: 1fr 1fr;
    }
    
    /* 3カラムレイアウト用 */
    .options-grid.three-column {
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* チェックボックススタイル */
    .checkbox-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 40px;
    }
    
    .checkbox-item {
        background: #f8fafc;
        border: 3px solid #e2e8f0;
        border-radius: 16px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        text-align: left;
    }
    
    .checkbox-item:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .checkbox-item.selected {
        background: #f0fdfa;
        border-color: #14b8a6;
        color: #0f766e;
        position: relative;
    }
    
    .checkbox-item.selected:hover {
        background: #ecfdf5;
        border-color: #0f766e;
    }
    
    .checkbox-text {
        flex: 1;
        font-weight: 600;
        font-size: 1rem;
        color: #374151;
        position: relative;
    }
    
    .checkbox-item.selected .checkbox-text {
        color: #0f766e;
    }
    
    .checkbox-item.selected .checkbox-text::before {
        content: '✓ ';
        color: #14b8a6;
        font-weight: 700;
        margin-right: 8px;
    }
    
    .checkbox-item.selected:hover .checkbox-text::before {
        content: '❌ ';
        color: #0f766e;
    }
    
    .help-icon {
        background: #e0f2fe;
        border: 2px solid #0891b2;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s ease;
        margin-left: 15px;
    }
    
    .help-icon:hover {
        background: #0891b2;
        color: white;
        transform: scale(1.1);
    }
    
    .help-text {
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border: 2px solid #0891b2;
        border-radius: 12px;
        padding: 20px;
        margin-top: 15px;
        text-align: left;
        line-height: 1.6;
        color: #374151;
        display: none;
        animation: slideDown 0.3s ease-out;
    }
    
    .help-text.show {
        display: block;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .navigation-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 40px;
    }
    
    .nav-btn {
        background: #6b7280;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
    }
    
    .nav-btn:hover {
        background: #4b5563;
        transform: translateY(-2px);
    }
    
    .nav-btn.primary {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
    }
    
    .nav-btn.primary:hover {
        background: linear-gradient(135deg, #0891b2, #0e7490);
    }
    
    .nav-btn:disabled {
        background: #d1d5db;
        cursor: not-allowed;
        transform: none;
    }
    
    /* 結果表示 */
    .result-container {
        text-align: center;
        padding: 40px;
    }
    
    .result-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        padding: 40px;
        margin: 20px auto;
        max-width: 600px;
        animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .result-card.standard {
        background: linear-gradient(135deg, #f0fdfa, #e6fffa);
        border: 3px solid #14b8a6;
    }
    
    .result-card.consumption_tax {
        background: linear-gradient(135deg, #fdf2f8, #fce7f3);
        border: 3px solid #ec4899;
    }
    
    .result-card.solvis {
        background: linear-gradient(135deg, #fff7ed, #ffedd5);
        border: 3px solid #f97316;
    }
    
    .result-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .result-icon {
        font-size: 3rem;
        margin-bottom: 20px;
        display: block;
    }
    
    .result-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 15px;
        line-height: 1.3;
    }
    
    .result-content {
        font-size: 1.1rem;
        line-height: 1.7;
        margin-bottom: 30px;
        text-align: left;
    }
    
    .result-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .result-btn {
        display: inline-block;
        padding: 15px 30px;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 1.1rem;
    }
    
    .result-btn:hover {
        transform: translateY(-2px);
    }
    
    .result-btn.primary {
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        color: white;
    }
    
    .result-btn.secondary {
        background: white;
        color: #14b8a6;
        border: 2px solid #14b8a6;
    }
    
    .result-btn.secondary:hover {
        background: #14b8a6;
        color: white;
    }
    
    /* プログレスバー */
    .progress-bar {
        position: absolute;
        top: 0;
        left: 0;
        height: 4px;
        background: linear-gradient(135deg, #14b8a6, #0891b2);
        border-radius: 2px;
        transition: width 0.5s ease;
    }
    
    /* モバイル対応 */
    @media (max-width: 768px) {
        .page-container {
            padding: 60px 10px 20px 10px;
        }
        
        .simulator-wrapper {
            padding: 0 10px;
        }
        
        .page-title-section {
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 2rem;
        }
        
        .step-container {
            padding: 30px 20px;
            min-height: auto;
            margin: 0 auto;
        }
        
        .step-number {
            font-size: 2.5rem;
            top: 10px;
            right: 15px;
            padding: 5px 15px;
        }
        
        .step-title {
            font-size: 1.6rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }
        
        .step-description {
            font-size: 0.95rem;
            margin-bottom: 30px;
        }
        
        .options-grid.two-column,
        .options-grid.three-column {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .option-item {
            padding: 18px 16px;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .checkbox-container {
            gap: 12px;
        }
        
        .checkbox-item {
            padding: 16px;
        }
        
        .checkbox-text {
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .help-icon {
            width: 28px;
            height: 28px;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .navigation-buttons {
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .nav-btn {
            width: 100%;
            max-width: 280px;
            padding: 16px 24px;
            font-size: 1rem;
        }
        
        /* 結果カード用のモバイル対応 */
        .result-card {
            padding: 25px 20px;
            margin: 15px auto;
            border-radius: 16px;
        }
        
        .result-title {
            font-size: 1.5rem;
            line-height: 1.3;
            margin-bottom: 20px;
        }
        
        .result-content {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .result-actions {
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        .result-btn {
            width: 100%;
            max-width: 280px;
            text-align: center;
            padding: 16px 24px;
            font-size: 1rem;
            border-radius: 10px;
        }
        
        /* プログレスバーのモバイル調整 */
        .progress-bar {
            height: 3px;
        }
    }
    
    @media (max-width: 480px) {
        .page-container {
            padding: 50px 8px 15px 8px;
        }
        
        .page-title-section {
            margin-bottom: 25px;
        }
        
        .page-title {
            font-size: 1.8rem;
        }
        
        .step-container {
            padding: 25px 15px;
            border-radius: 16px;
        }
        
        .step-number {
            font-size: 2rem;
            top: 8px;
            right: 12px;
            padding: 4px 12px;
        }
        
        .step-icon {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .step-title {
            font-size: 1.4rem;
            margin-bottom: 12px;
        }
        
        .step-description {
            font-size: 0.9rem;
            margin-bottom: 25px;
        }
        
        .option-item {
            padding: 16px 14px;
            font-size: 0.95rem;
        }
        
        .checkbox-item {
            padding: 14px;
        }
        
        .checkbox-text {
            font-size: 0.9rem;
        }
        
        .help-icon {
            width: 26px;
            height: 26px;
            font-size: 13px;
        }
        
        .nav-btn {
            padding: 15px 20px;
            font-size: 0.95rem;
        }
        
        .result-card {
            padding: 20px 15px;
            margin: 10px auto;
        }
        
        .result-title {
            font-size: 1.3rem;
        }
        
        .result-content {
            font-size: 0.95rem;
        }
        
        .result-btn {
            padding: 15px 20px;
            font-size: 0.95rem;
        }
    }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <h1><a href="/">みんなの税務顧問</a></h1>
                </div>
                
                <!-- Desktop Navigation -->
                <nav class="nav-desktop">
                    <a href="/#services" class="nav-link">サービス内容</a>
                    <a href="/#plans" class="nav-link">料金</a>
                    <a href="/#cost-comparison" class="nav-link">コスト比較</a>
                </nav>
                
                <!-- Desktop CTA Button -->
                <div class="cta-desktop">
                    <a href="/#contact" class="btn btn-primary">申込はこちら</a>
                </div>
                
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="メニューを開く">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- Mobile Menu -->
                <nav class="mobile-menu" id="mobileMenu">
                    <a href="/#services" class="mobile-nav-link">サービス内容</a>
                    <a href="/#plans" class="mobile-nav-link">料金</a>
                    <a href="/#cost-comparison" class="mobile-nav-link">コスト比較</a>
                    <a href="/#contact" class="btn btn-primary mobile-cta">申込はこちら</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Page Container -->
    <section class="page-container">
        <div class="simulator-wrapper">
            <!-- Page Title -->
            <div class="page-title-section">
                <h1 class="page-title">料金シミュレーター</h1>
            </div>
            
            <div class="step-container" id="stepContainer">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                <div class="step-number" id="stepNumber">1</div>
                
                <!-- Step Content will be dynamically inserted here -->
                <div id="stepContent"></div>
                
                <!-- Navigation Buttons -->
                <div class="navigation-buttons" id="navigationButtons">
                    <button class="nav-btn" id="prevBtn" onclick="previousStep()" style="display: none;">前に戻る</button>
                    <button class="nav-btn primary" id="nextBtn" onclick="nextStep()" disabled>次に進む</button>
                </div>
            </div>
        </div>
    </section>

    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let simulatorData = {};

        const steps = {
            1: {
                icon: '',
                title: '年間の売上金額はいくらですか？',
                description: '起業1年目の方は想定される年間売上高（年商）を選択してください。',
                type: 'single-choice',
                options: [
                    { value: 'under300', label: '300万円未満' },
                    { value: '300-500', label: '300～500万円' },
                    { value: '500-1000', label: '500万円～1,000万円未満' },
                    { value: '1000-3000', label: '1,000万円超～3,000万円' },
                    { value: 'over3000', label: '3,000万円超' },
                    { value: 'unknown', label: 'わからない' }
                ]
            },
            2: {
                icon: '',
                title: '事業形態',
                description: '',
                type: 'single-choice',
                options: [
                    { value: 'individual', label: '個人事業主・フリーランス・副業等' },
                    { value: 'corporation', label: '法人' },
                    { value: 'considering', label: '法人化を検討中' }
                ]
            },
            3: {
                icon: '',
                title: '該当する項目をすべて選択してください',
                description: '※ 消費税申告が必要かどうかを判定するために必要な情報です',
                type: 'multi-choice',
                options: [
                    { 
                        value: 'invoice', 
                        label: 'インボイス発行事業者として登録済み',
                        help: 'インボイス発行事業者とは？\n\n適格請求書（インボイス）を発行できる事業者として税務署に登録している事業者のことです。2023年10月から始まったインボイス制度に対応するため、多くの事業者が登録しています。登録済みの場合は自動的に消費税の課税事業者となります。'
                    },
                    { 
                        value: 'over1000Before', 
                        label: '2年前の売上が1,000万円を超えている',
                        help: '基準期間とは？\n\n2年前の1年間を「基準期間」と呼びます。例えば、2024年分の申告であれば2022年の売上が対象です。基準期間の課税売上高が1,000万円を超えている場合、消費税の課税事業者となります。'
                    },
                    { 
                        value: 'over1000Recent', 
                        label: '前年前半6ヶ月の売上が1,000万円を超えている',
                        help: '特定期間とは？\n\n前年の1月から6月までの6ヶ月間を「特定期間」と呼びます。この期間の課税売上高または給与支払額のいずれかが1,000万円を超えている場合、消費税の課税事業者となります。'
                    },
                    { 
                        value: 'voluntary', 
                        label: '任意で課税事業者を選択している',
                        help: '任意の課税事業者選択とは？\n\n売上が1,000万円以下でも、自ら選択して消費税の課税事業者になることができます。「消費税課税事業者選択届出書」を税務署に提出している場合がこれに該当します。設備投資で消費税の還付を受けたい場合などに選択します。'
                    },
                    { 
                        value: 'exportRefund', 
                        label: '輸出や消費税還付を受けたい',
                        help: '輸出・消費税還付とは？\n\n商品やサービスを海外に輸出する場合、国内の消費税は免税となります。また、仕入れなどで支払った消費税との差額で還付を受けられる場合があります。輸出業務や設備投資により消費税の還付を期待される場合は消費税申告が必要です。'
                    },
                    { 
                        value: 'blueReturn', 
                        label: '青色申告の申請をしたい',
                        help: '青色申告とは？\n\n帳簿をきちんとつけることを条件に、税制上の特典を受けられる申告方法です。65万円の特別控除や家族への給与の経費算入などのメリットがあります。\n\n青色申告承認申請書の提出期限\n・新規開業の場合：開業から2ヶ月以内\n・既存事業者の場合：青色申告を受けようとする年の3月15日まで\n\n代行費用について\n青色申告承認申請書をご自身で提出されない場合、代行費用として別途5,000円（税込）を申し受けます。申請に関しては契約後のChatwork内でのご相談となります。'
                    },
                    { 
                        value: 'businessRegistration', 
                        label: '開業届の申請をしたい',
                        help: '開業届とは？\n\n個人事業を開始したことを税務署に届け出るための書類です。事業開始から1ヶ月以内に提出する必要があります。屋号の使用や青色申告の前提となる重要な手続きです。\n\n開業届の提出期限\n事業開始から1ヶ月以内に所轄の税務署に提出してください。\n\n代行費用について\n開業届をご自身で提出されない場合、代行費用として別途5,000円（税込）を申し受けます。申請に関しては契約後のChatwork内でのご相談となります。'
                    },
                    { 
                        value: 'cryptoFx', 
                        label: '暗号資産・仮想通貨のFXでの利益がある',
                        help: '暗号資産・仮想通貨の税務とは？\n\nビットコインなどの暗号資産の売買やFX取引で得た利益は、原則として雑所得となり確定申告が必要です。取引の記録をしっかり残しておくことが重要です。年間売上が1,000万円未満であれば当サービスで対応可能です。\n\n追加料金について\n暗号資産の雑所得申告には、別途30,000円（税込）の追加料金が発生いたします。申請に関しては契約後のChatwork内でのご相談となります。'
                    },
                    { 
                        value: 'reselling', 
                        label: 'せどり・輸入・転売での利益がある',
                        help: 'せどり・転売ビジネスとは？\n\n商品を仕入れて販売する事業のことです。Amazon、メルカリ、eBayなどでの販売も含まれます。継続的に行っている場合は事業所得となり、確定申告が必要です。年間売上が1,000万円未満であれば当サービスで対応可能です。'
                    }
                ]
            },
            4: {
                icon: '',
                title: '月間取引件数（予想）',
                description: '',
                type: 'single-choice',
                options: [
                    { value: 'under50', label: '50件未満' },
                    { value: '50-100', label: '50〜100件' },
                    { value: '100-200', label: '100〜200件' },
                    { value: 'over200', label: '200件以上' }
                ]
            }
        };

        function initializeSimulator() {
            renderStep(currentStep);
        }

        function renderStep(stepNumber) {
            const step = steps[stepNumber];
            const stepContent = document.getElementById('stepContent');
            const stepNumberEl = document.getElementById('stepNumber');
            const progressBar = document.getElementById('progressBar');
            
            // Update step number and progress
            if (stepNumber <= totalSteps) {
                stepNumberEl.textContent = `${stepNumber}/${totalSteps}`;
                stepNumberEl.style.display = 'block';
                progressBar.style.width = `${(stepNumber / totalSteps) * 100}%`;
            } else {
                // Hide step number for result page
                stepNumberEl.style.display = 'none';
                progressBar.style.width = '100%';
            }
            
            let content = '';
            
            if (stepNumber <= totalSteps) {
                content = `
                    <div class="step-header">
                        <div class="step-icon">${step.icon}</div>
                        <h2 class="step-title">${step.title}</h2>
                        ${step.description ? `<p class="step-description">${step.description}</p>` : ''}
                    </div>
                `;
                
                if (step.type === 'single-choice') {
                    const columns = step.options.length <= 2 ? 'two-column' : 
                                   step.options.length <= 3 ? 'three-column' : '';
                    content += `<div class="options-grid ${columns}">`;
                    step.options.forEach(option => {
                        const isSelected = simulatorData[`step${stepNumber}`] === option.value;
                        content += `
                            <div class="option-item ${isSelected ? 'selected' : ''}" 
                                 onclick="selectOption(${stepNumber}, '${option.value}')">
                                ${option.label}
                            </div>
                        `;
                    });
                    content += '</div>';
                } else if (step.type === 'multi-choice') {
                    content += '<div class="checkbox-container">';
                    step.options.forEach((option, index) => {
                        const isSelected = simulatorData[`step${stepNumber}`] && 
                                         simulatorData[`step${stepNumber}`].includes(option.value);
                        content += `
                            <div class="checkbox-item ${isSelected ? 'selected' : ''}" 
                                 onclick="toggleOption(${stepNumber}, '${option.value}')">
                                <span class="checkbox-text">${option.label}</span>
                                ${option.help ? `<div class="help-icon" onclick="event.stopPropagation(); toggleHelp('help-${stepNumber}-${index}')">❓</div>` : ''}
                            </div>
                            ${option.help ? `<div class="help-text" id="help-${stepNumber}-${index}">${option.help.replace(/\n/g, '<br>')}</div>` : ''}
                        `;
                    });
                    content += '</div>';
                }
            } else {
                // Show results
                const result = calculatePlan();
                content = `
                    <div class="result-container">
                        <div class="result-card ${result.type}">
                            <div class="result-header">
                                <span class="result-icon">${result.icon}</span>
                                <h2 class="result-title">${result.title}</h2>
                            </div>
                            <div class="result-content">${result.content}</div>
                            <div class="result-actions">
                                ${result.actions.map(action => 
                                    `<a href="${action.url}" class="result-btn ${action.primary ? 'primary' : 'secondary'}" 
                                       ${action.url.startsWith('http') ? 'target="_blank" rel="noopener noreferrer"' : ''}>
                                        ${action.text}
                                    </a>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            stepContent.innerHTML = content;
            updateNavigationButtons();
        }

        function selectOption(stepNumber, value) {
            // 既に選択されている項目を再度クリックした場合は選択を解除
            if (simulatorData[`step${stepNumber}`] === value) {
                delete simulatorData[`step${stepNumber}`];
            } else {
                simulatorData[`step${stepNumber}`] = value;
            }
            renderStep(stepNumber);
        }

        function toggleOption(stepNumber, value) {
            if (!simulatorData[`step${stepNumber}`]) {
                simulatorData[`step${stepNumber}`] = [];
            }
            
            const index = simulatorData[`step${stepNumber}`].indexOf(value);
            if (index > -1) {
                simulatorData[`step${stepNumber}`].splice(index, 1);
            } else {
                simulatorData[`step${stepNumber}`].push(value);
            }
            
            renderStep(stepNumber);
        }

        function toggleHelp(helpId) {
            const helpElement = document.getElementById(helpId);
            if (helpElement) {
                helpElement.classList.toggle('show');
            }
        }

        function nextStep() {
            if (currentStep <= totalSteps) {
                currentStep++;
                renderStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                renderStep(currentStep);
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Show/hide previous button
            if (currentStep > 1 && currentStep <= totalSteps) {
                prevBtn.style.display = 'block';
            } else {
                prevBtn.style.display = 'none';
            }
            
            // Update next button
            if (currentStep > totalSteps) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
                
                // Check if current step has valid selection
                const isStepComplete = isCurrentStepComplete();
                nextBtn.disabled = !isStepComplete;
                
                if (currentStep === totalSteps) {
                    nextBtn.textContent = '最適なプランを診断する';
                } else {
                    nextBtn.textContent = '次に進む';
                }
            }
        }

        function isCurrentStepComplete() {
            const stepData = simulatorData[`step${currentStep}`];
            const step = steps[currentStep];
            
            if (step.type === 'single-choice') {
                return stepData !== undefined;
            } else if (step.type === 'multi-choice') {
                return true; // Multi-choice can be empty
            }
            
            return false;
        }

        function calculatePlan() {
            const revenue = simulatorData.step1;
            const businessType = simulatorData.step2;
            const conditions = simulatorData.step3 || [];
            const transactions = simulatorData.step4;
            
            // 【最優先】年間売上が1000万円を超える場合はソルビス税理士法人を案内
            if (revenue === '1000-3000' || revenue === 'over3000') {
                return {
                    type: 'solvis',
                    icon: '',
                    title: 'ソルビス税理士法人をご紹介いたします',
                    content: `年間売上が1,000万円を超える事業者様は、「みんなの税務顧問」の対象外となります。<br><br>より大規模な事業に対応可能な「ソルビス税理士法人」でのご契約をお願いいたします。<br><br>・売上1,000万円超の事業に特化<br>・より高度な税務相談<br>・法人化支援<br>・節税対策の提案<br>・事業拡大に向けたアドバイス<br>・消費税申告も含む総合サポート`,
                    actions: [
                        { text: 'ソルビス税理士法人に相談', url: 'https://www.solvis-tax.com/', primary: true }
                    ]
                };
            }

            // 1000万円未満の場合、消費税申告が必要かチェック
            const needsConsumptionTax = conditions.includes('invoice') || 
                                      conditions.includes('over1000Before') || 
                                      conditions.includes('over1000Recent') || 
                                      conditions.includes('voluntary') || 
                                      conditions.includes('exportRefund');

            // プラン判定（1000万円未満のみ）
            if (needsConsumptionTax) {
                return {
                    type: 'consumption_tax',
                    icon: '',
                    title: '消費税申告プランがおすすめです',
                    content: `お客様の事業状況では消費税の申告が必要です。消費税申告に対応したプランをご提案いたします。<br><br>• 年払い: 月額10,740円（年間128,880円）<br>• 月払い: 月額12,300円（年間147,600円）<br><br>年払いプランなら約12%お得になります！`,
                    actions: [
                        { text: '消費税申告プランを見る', url: '/cost.tax', primary: true }
                    ]
                };
            } else {
                // 通常プランの場合の追加メッセージ
                let additionalContent = '';
                if (conditions.includes('blueReturn') || conditions.includes('businessRegistration')) {
                    additionalContent = '<br><br>※申請代行について<br>・青色申告承認申請書、開業届の代行をご希望の場合は別途5,000円（税込）を申し受けます<br>・申請に関しては契約後のChatwork内でのご相談となります';
                }

                return {
                    type: 'standard',
                    icon: '',
                    title: '通常プランがおすすめです',
                    content: `お客様の事業状況に最適な通常プランをおすすめいたします。<br><br>• 年払い: 月額8,256円（年間99,080円）<br>• 月払い: 月額9,800円（年間117,600円）<br><br>年払いプランなら約15%お得になります！${additionalContent}`,
                    actions: [
                        { text: '通常プランを見る', url: '/cost', primary: true }
                    ]
                };
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initializeSimulator();
        });
    </script>

    <script src="script.js"></script>
</body>
</html>
